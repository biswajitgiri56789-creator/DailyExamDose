name: 24/7 Daily Exam Dose Bot

on:
  workflow_dispatch:
  schedule:
    - cron: '*/30 * * * *'

jobs:
  run-bot:
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ“‚ Checkout Repository
        uses: actions/checkout@v4
        
      - name: ğŸ Setup Python 3.10
        uses: actions/setup-python@v4
        with:
          python-version: '3.10'
          
      - name: ğŸ“¦ Install Dependencies
        run: |
          pip install requests
          
      - name: ğŸ” Debug Info
        run: |
          echo "ğŸ”§ System Information:"
          echo "Python: $(python --version)"
          echo "Pip: $(pip --version)"
          echo "Current Dir: $(pwd)"
          ls -la
          
      - name: ğŸ§ª Test 1: Environment Variables
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          echo "ğŸ” Checking Environment Variables:"
          echo "BOT_TOKEN length: ${#BOT_TOKEN}"
          echo "CHAT_ID: $CHAT_ID"
          
          if [ -z "$BOT_TOKEN" ]; then
            echo "âŒ BOT_TOKEN is empty!"
            exit 1
          fi
          
          if [ -z "$CHAT_ID" ]; then
            echo "âŒ CHAT_ID is empty!"
            exit 1
          fi
          
          echo "âœ… Environment variables are set"
          
      - name: ğŸ§ª Test 2: Direct API Test
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          echo "ğŸ” Testing direct API call..."
          
          # Test bot token
          BOT_STATUS=$(curl -s "https://api.telegram.org/bot$BOT_TOKEN/getMe")
          echo "Bot Status: $BOT_STATUS"
          
          # Send test message
          RESPONSE=$(curl -s -X POST "https://api.telegram.org/bot$BOT_TOKEN/sendMessage" \
            -d "chat_id=$CHAT_ID" \
            -d "text=ğŸ”„ GitHub Actions Test Message" \
            -d "parse_mode=Markdown")
          
          echo "API Response: $RESPONSE"
          
          if echo "$RESPONSE" | grep -q '"ok":true'; then
            echo "âœ… API Test Successful!"
          else
            echo "âŒ API Test Failed!"
            exit 1
          fi
          
      - name: ğŸ¤– Run Bot Script
        env:
          BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
          CHAT_ID: ${{ secrets.CHAT_ID }}
        run: |
          echo "ğŸš€ Running main bot script..."
          python simple_bot.py
          
      - name: âœ… Final Check
        if: success()
        run: |
          echo "ğŸ‰ Workflow completed successfully!"
          echo "ğŸ“¤ Check your Telegram channel for the message"
          date
          
      - name: âŒ Error Report
        if: failure()
        run: |
          echo "âš ï¸ Workflow failed!"
          echo "ğŸ”§ Check the logs above for errors"
          echo "ğŸ’¡ Common issues:"
          echo "1. BOT_TOKEN incorrect"
          echo "2. CHAT_ID incorrect"
          echo "3. Bot not admin in channel"
          echo "4. Network issues"
